//////////////////////////////////////////////////////////////////////
//====================================================================
//
//	使い魔スクリプト専用インクルードライブラリ
//
//		※使い魔スクリプト以外からは使用出来ません。
//			それ以外からはインクルードしないでください。
//
//====================================================================
//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
//--------------------------------------------------------------------
//	下位ライブラリをインクルード
//--------------------------------------------------------------------
//////////////////////////////////////////////////////////////////////
#include_function ".\INCLUDE\EnemyShadow.dnh"


//////////////////////////////////////////////////////////////////////
//--------------------------------------------------------------------
//	定数
//--------------------------------------------------------------------
//////////////////////////////////////////////////////////////////////

let SHADOW_TIMELAG = 8;	//	切り替わりのタイムラグ


//////////////////////////////////////////////////////////////////////
//--------------------------------------------------------------------
//	メンバ変数
//--------------------------------------------------------------------
//////////////////////////////////////////////////////////////////////

let m_nChangeTime = 0;	//	最後に切り替わった時間
let m_bHidden = false;	//	隠蔽中か否か


//////////////////////////////////////////////////////////////////////
//--------------------------------------------------------------------
//	判定関数
//--------------------------------------------------------------------
//////////////////////////////////////////////////////////////////////

//	タイムラグ時間終了したか否かを返す
function IsElapsedTimeLag(){ return m_nCount - m_nChangeTime > SHADOW_TIMELAG; }


//////////////////////////////////////////////////////////////////////
//--------------------------------------------------------------------
//	未分類
//--------------------------------------------------------------------
//////////////////////////////////////////////////////////////////////

//	死亡時に特定半径の弾を消す
function DestructShadow( let fRadius ){
	if( !BeVanished() ){ DeleteEnemyShotToItemInCircle( SHOT, GetX(), GetY(), fRadius ); }
	DeleteEnemyShotToItemInCircle( ALL, GetX(), GetY(), 0 );
}

//	基本処理
//	※@MainLoopの最後に毎回呼び出してください
function BehaviorShadow( let szSEHiddenFile, let szSESuddenFile ){
	alternative( GetKeyState( VK_SLOWMOVE ) )
	case( KEY_PUSH ){
		PlaySE( szSEHiddenFile );
		m_nChangeTime = m_nCount;
	}
	case( KEY_PULL ){
		PlaySE( szSESuddenFile );
		m_nChangeTime = m_nCount;
	}
	case( KEY_HOLD ){ if( IsElapsedTimeLag() ){ m_bHidden = true; } }
	case( KEY_FREE ){ if( IsElapsedTimeLag() ){ m_bHidden = false; } }
}

///////////////////////////////////
//追加060214　使い魔のdrowloop
///////////////////////////////////
function _DrowShadow( let FileName, let now, let x, let y, let Dxy){
	SetTexture(FileName);
	SetGraphicRect(x,y,x+Dxy,y+Dxy);
	if(GetKeyState(VK_SLOWMOVE)==KEY_PUSH||GetKeyState(VK_SLOWMOVE)==KEY_HOLD){
		SetAlpha(127);
		SetGraphicScale(0.8,0.8);
	}
	else{
		SetAlpha(255);
		SetGraphicScale(0.5,0.5);
	}
	SetGraphicAngle(0,0,now);
	DrawGraphic(GetX,GetY);
}

function DrowShadowEasy(let now){
	_DrowShadow( dotCircle6s,now,0,0,64);
}

//実体化時の光
function LightOfShadow(let now){
	if(GetKeyState(VK_SLOWMOVE)==KEY_FREE)
	{
		Collision( 16,12 );
		if(int(now/3)==now/3)
		{
			CreateShotA(0,GetX(),GetY(),10);
			SetShotDataA(0,0,0,0,0,0,0,WHITE05);
			SetShotKillTime(0,0);
			FireShot(0);
		}
	}
}

